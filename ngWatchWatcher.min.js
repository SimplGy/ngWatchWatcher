angular.module("watchWatcher",[]),angular.module("watchWatcher").factory("scopeCounters",["$rootScope",function(a){function b(b){b=b||a;var c,d;if(c=0,b.$$childHead)for(c++,d=b.$$childHead;d.$$nextSibling;)c++,d=d.$$nextSibling;return c}function c(a){a=a||angular.element(document.body);var b;return b=[],a.data().hasOwnProperty("$scope")&&b.push(a.data().$scope),angular.forEach(a.children(),function(a){return c($(a))}),b}function d(b){for(var c=[b||a],d=[],e=null;c.length>0;)e=c.pop(),e&&d.push(e),e.$$childHead&&c.push(e.$$childHead),e.$$nextSibling&&c.push(e.$$nextSibling);return d}return api={countChildren:b,byEl:c,byScope:d}}]),function(){describe("scopeCounters.factory",function(){var a,b,c,d,e;return d=void 0,e=void 0,a=void 0,b=void 0,c=void 0,beforeEach(function(){return angular.mock.module("watchWatcher"),angular.mock.inject(function(d,f,g){return e=d,a=f,a.$new(),b=a.$new(),b.$new(),b.$new(),b.$new(),b.testVal="Scope is working",c=g("<div>{{testVal}}</div>")(b),a.$digest()})}),it("is defined",function(){return expect(e).toBeDefined()}),describe("test scope preparation",function(){return it("$rootScope is available and looks like an angular scope",function(){return expect(a).toBeDefined(),expect(typeof a.$new).toBe("function")}),it("$rootScope has other scopes in it",function(){return expect(a.$$childHead).toBeDefined(),expect(a.$$childHead.$$nextSibling).toBeDefined()})}),describe(".countChildren(scope)",function(){return it("is a function",function(){return expect(typeof e.countChildren).toBe("function")}),it("gets correct counts of immediate children",function(){return expect(e.countChildren(a)).toBe(2),expect(e.countChildren(b)).toBe(3),b.$new(),expect(e.countChildren(b)).toBe(4)}),it("detects isolate scope",function(){return expect(e.countChildren(b)).toBe(3),b.$new(!0),expect(e.countChildren(b)).toBe(4)})}),describe(".byScope()",function(){return it("is a function",function(){return expect(typeof e.byScope).toBe("function")}),it("finds the right number of scopes",function(){return expect(e.byScope().length).toBe(6)}),it("detects the results of destorying scope",function(){return expect(e.byScope().length).toBe(6),b.$$childHead.$destroy(),expect(e.byScope().length).toBe(5),b.$destroy(),expect(e.byScope().length).toBe(2)})}),describe("byEl",function(){return it("is a function",function(){return expect(typeof e.byEl).toBeDefined()}),it("has an element to test against",function(){return expect(c.html()).toBe("Scope is working")}),it("Finds scopes by element",function(){return expect(e.byEl(c).length).toBe(1)})})})}.call(this),angular.module("watchWatcher").factory("watchCounters",["$rootScope",function(a){function b(a){a=a||angular.element(document.body);var c;return c=[],a.data().hasOwnProperty("$scope")&&(c=c.concat(a.data().$scope.$$watchers)),angular.forEach(a.children(),function(a){return b($(a))}),c}function c(b){for(var c=[b||a],d=[],e=null;c.length>0;)e=c.pop(),e.$$watchers&&(d=d.concat(e.$$watchers)),e.$$childHead&&c.push(e.$$childHead),e.$$nextSibling&&c.push(e.$$nextSibling);return d}return api={byEl:b,byScope:c}}]),function(){describe("watchCounters.factory",function(){var a,b,c,d,e;return d=void 0,e=void 0,a=void 0,b=void 0,c=void 0,beforeEach(function(){return angular.mock.module("watchWatcher"),angular.mock.inject(function(d,f,g){return e=d,a=f,a.$new(),b=a.$new(),b.$new(),b.$new(),a.$watch(function(){}),a.$watch(function(){}),b.testVal="Scope is working",c=g('<div ng-class="{ hasVal: testVal }">{{testVal}}</div>')(b),a.$digest()})}),it("is defined",function(){return expect(e).toBeDefined()}),describe("test scope preparation",function(){return it("$rootScope is available and looks like an angular scope",function(){return expect(a).toBeDefined(),expect(typeof a.$new).toBe("function")}),it("$rootScope has other scopes in it",function(){return expect(a.$$childHead).toBeDefined(),expect(a.$$childHead.$$nextSibling).toBeDefined()})}),describe(".byScope()",function(){return it("counts the correct number of watches on a scope",function(){return expect(e.byScope(b).length).toBe(2)}),it("counts watches on the scope and all it's children",function(){return expect(e.byScope(a).length).toBe(4)})}),describe(".byEl()",function(){return it("counts by element correctly",function(){return expect(e.byEl(c).length).toBe(2)})})})}.call(this),angular.module("watchWatcher").controller("WatchLightController",["$rootScope",function(){console.log("controller")}]),angular.module("watchWatcher").directive("watchLight",["$rootScope",function(a){return{restrict:"E",template:'<i class="watchLight"\n   title="Blinking indicates $digest loop activity.\nClick to log details."\n   style="cursor: pointer;\n   display: block; position: fixed;\n   top: 10px; right: 10px;\n   width:14px; height:14px;\n   border-radius: 50%; background-color: #ddd;\n   -webkit-transition:background-color .15s, box-shadow .04s;\n   transition:background-color .15s, box-shadow .04s;\n"></i>',replace:!0,controller:"WatchLightController",link:function(b,c){function d(a,b){a=a||"#5AB953",b=b||"#29832B",c.css("background-color",a),c.css("box-shadow","inset 0 0 0 2px "+b),clearTimeout(k),clearTimeout(l),k=setTimeout(e,700),l=setTimeout(f,100)}function e(){c.css("background-color","#ddd")}function f(){c.css("box-shadow","inset 0 0 0 0 #49A34B")}function g(){m++;var a={start:Date.now()};return n.push(a),setTimeout(function(){a.end=Date.now(),a.duration=a.end-a.start},0),d(),!1}function h(a){var b=a.length,c=a[b-1].start-a[0].start;return c/=1e3,Math.round(b/c*10)/10}function i(a){var b,c,d,e=0;for(b=0,c=a.length;c>b;b++)d=a[b].duration,d&&(e+=d);return Math.round(e/c*10)/10}function j(){n.length>p&&(n=n.slice(-p))}var k,l,m=(Date.now(),0),n=[],o=5e3,p=50;c.on("click",function(){d("#69d","#369"),j(),console.log("\nDigest Information\n------------------\nDigests Per Second:      "+h(n)+" digests (fewer is better)\nAverage Digest Duration: "+i(n)+" ms      (shorter is better)\nWatches Fired So Far:    "+m+"\n\n",{digests:n})}),setInterval(j,o),a.$watch(g)}}}]);