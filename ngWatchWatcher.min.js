angular.module("watchWatcher",[]),angular.module("watchWatcher").factory("scopeCounters",["$rootScope",function(a){function b(b){b=b||a;var c,d;if(c=0,b.$$childHead)for(c++,d=b.$$childHead;d.$$nextSibling;)c++,d=d.$$nextSibling;return c}function c(a){a=a||angular.element(document.body);var b;return b=[],a.data().hasOwnProperty("$scope")&&b.push(a.data().$scope),angular.forEach(a.children(),function(a){return c($(a))}),b}function d(b){for(var c=[b||a],d=[],e=null;c.length>0;)e=c.pop(),e&&d.push(e),e.$$childHead&&c.push(e.$$childHead),e.$$nextSibling&&c.push(e.$$nextSibling);return d}return api={countChildren:b,byEl:c,byScope:d}}]),function(){describe("scopeCounters.factory",function(){var a,b,c,d,e;return d=void 0,e=void 0,a=void 0,b=void 0,c=void 0,beforeEach(function(){return angular.mock.module("watchWatcher"),angular.mock.inject(function(d,f,g){return e=d,a=f,a.$new(),b=a.$new(),b.$new(),b.$new(),b.$new(),b.testVal="Scope is working",c=g("<div>{{testVal}}</div>")(b),a.$digest()})}),it("is defined",function(){return expect(e).toBeDefined()}),describe("test scope preparation",function(){return it("$rootScope is available and looks like an angular scope",function(){return expect(a).toBeDefined(),expect(typeof a.$new).toBe("function")}),it("$rootScope has other scopes in it",function(){return expect(a.$$childHead).toBeDefined(),expect(a.$$childHead.$$nextSibling).toBeDefined()})}),describe(".countChildren(scope)",function(){return it("is a function",function(){return expect(typeof e.countChildren).toBe("function")}),it("gets correct counts of immediate children",function(){return expect(e.countChildren(a)).toBe(2),expect(e.countChildren(b)).toBe(3),b.$new(),expect(e.countChildren(b)).toBe(4)}),it("detects isolate scope",function(){return expect(e.countChildren(b)).toBe(3),b.$new(!0),expect(e.countChildren(b)).toBe(4)})}),describe(".byScope()",function(){return it("is a function",function(){return expect(typeof e.byScope).toBe("function")}),it("finds the right number of scopes",function(){return expect(e.byScope().length).toBe(6)}),it("detects the results of destorying scope",function(){return expect(e.byScope().length).toBe(6),b.$$childHead.$destroy(),expect(e.byScope().length).toBe(5),b.$destroy(),expect(e.byScope().length).toBe(2)})}),describe("byEl",function(){return it("is a function",function(){return expect(typeof e.byEl).toBeDefined()}),it("has an element to test against",function(){return expect(c.html()).toBe("Scope is working")}),it("Finds scopes by element",function(){return expect(e.byEl(c).length).toBe(1)})})})}.call(this),angular.module("watchWatcher").factory("watchCounters",["$rootScope",function(a){function b(a){a=a||angular.element(document.body);var c;return c=[],a.data().hasOwnProperty("$scope")&&(c=c.concat(a.data().$scope.$$watchers)),angular.forEach(a.children(),function(a){return b($(a))}),c}function c(b){for(var c=[b||a],d=[],e=null;c.length>0;)e=c.pop(),e.$$watchers&&(d=d.concat(e.$$watchers)),e.$$childHead&&c.push(e.$$childHead),e.$$nextSibling&&c.push(e.$$nextSibling);return d}return api={byEl:b,byScope:c}}]),function(){describe("watchCounters.factory",function(){var a,b,c,d,e;return d=void 0,e=void 0,a=void 0,b=void 0,c=void 0,beforeEach(function(){return angular.mock.module("watchWatcher"),angular.mock.inject(function(d,f,g){return e=d,a=f,a.$new(),b=a.$new(),b.$new(),b.$new(),a.$watch(function(){}),a.$watch(function(){}),b.testVal="Scope is working",c=g('<div ng-class="{ hasVal: testVal }">{{testVal}}</div>')(b),a.$digest()})}),it("is defined",function(){return expect(e).toBeDefined()}),describe("test scope preparation",function(){return it("$rootScope is available and looks like an angular scope",function(){return expect(a).toBeDefined(),expect(typeof a.$new).toBe("function")}),it("$rootScope has other scopes in it",function(){return expect(a.$$childHead).toBeDefined(),expect(a.$$childHead.$$nextSibling).toBeDefined()})}),describe(".byScope()",function(){return it("counts the correct number of watches on a scope",function(){return expect(e.byScope(b).length).toBe(2)}),it("counts watches on the scope and all it's children",function(){return expect(e.byScope(a).length).toBe(4)})}),describe(".byEl()",function(){return it("counts by element correctly",function(){return expect(e.byEl(c).length).toBe(2)})})})}.call(this),angular.module("watchWatcher").controller("WatchLightController",function(){function a(){h++;var a={start:Date.now()};i.push(a),setTimeout(function(){a.end=Date.now(),a.duration=a.end-a.start},0)}function b(a){a=a||i;var b=a.length,c=a[b-1].start-a[0].start;return c/=1e3,Math.round(b/c*10)/10}function c(a){a=a||i;var b,c,d,e=0;for(b=0,c=a.length;c>b;b++)d=a[b].duration,d&&(e+=d);return Math.round(e/c*10)/10}function d(){console.log("\nDigest Information\n------------------\nDigests Per Second:      "+b(i)+" digests   (fewer is less taxing)\nAverage Digest Duration: "+c(i)+" ms        (shorter is more performant)\nWatches Fired So Far:    "+h+"\n\n",{digests:i})}function e(){i.length>g&&(i=i.slice(-g))}var f=5e3,g=50,h=0,i=[];setInterval(e,f),this.cleanUp=e,this.countWatch=a,this.logInformation=d,this.getDigestsPerSecond=b,this.getAverageDigestDuration=c,this.getRecentDigests=function(){return i}}),function(){describe("watchLight.controller",function(){var a,b;return a=void 0,b=function(a){var b,c;for(a=a||10,b=Date.now(),c=[];Date.now()-b<a;)c.push(b);return c},beforeEach(function(){return angular.mock.module("watchWatcher"),angular.mock.inject(function(b){return a=b("WatchLightController")})}),describe(".countWatch()",function(){return it("Adds measurements",function(){return expect(a.getRecentDigests().length).toBe(0),a.countWatch(),a.countWatch(),a.countWatch(),expect(a.getRecentDigests().length).toBe(3)}),it("measures duration",function(){var c;return expect(a.getRecentDigests().length).toBe(0),a.countWatch(),b(10),c=a.getRecentDigests()[0],expect(c).toBeDefined(),waits(20),runs(function(){var a;return expect(10<=(a=c.duration)&&15>a).toBe(!0)})})}),describe(".getDigestsPerSecond()",function(){return it("averages out digests over time",function(){var b,c;for(expect(a.getRecentDigests().length).toBe(0),b=c=1;5>=c;b=++c)a.countWatch();return waits(100),runs(function(){var c,d;for(b=c=1;5>=c;b=++c)a.countWatch();return expect(a.getRecentDigests().length).toBe(10),expect(95<(d=a.getDigestsPerSecond())&&105>d).toBe(!0)})})}),describe(".getAverageDigestDuration()",function(){return it("gets the average duration of one digest",function(){return expect(a.getRecentDigests().length).toBe(0),a.countWatch(),b(50),waits(0),runs(function(){var b;return expect(a.getRecentDigests().length).toBe(1),expect(45<(b=a.getAverageDigestDuration())&&55>b).toBe(!0)})}),it("gets the average duration of many digests",function(){return expect(a.getRecentDigests().length).toBe(0),waits(0),runs(function(){return a.countWatch(),b(10)}),waits(0),runs(function(){return a.countWatch(),b(100)}),waits(0),runs(function(){var b,c,d;return expect(a.getRecentDigests().length).toBe(2),c=a.getRecentDigests()[0].duration,d=a.getRecentDigests()[1].duration,b=a.getAverageDigestDuration(),console.log("fast: "+c+". slow: "+d+", avg: "+b),expect(c>5&&15>c).toBe(!0),expect(d>95&&120>d).toBe(!0),expect(Math.round(b)).toBe(Math.round((c+d)/2))})})})})}.call(this),angular.module("watchWatcher").directive("watchLight",["$rootScope",function(a){return{restrict:"E",template:'<i class="watchLight"\n   title="Blinking indicates $digest loop activity.\nClick to log details."\n   style="cursor: pointer;\n   display: block; position: fixed;\n   top: 10px; right: 10px;\n   width:14px; height:14px;\n   border-radius: 50%; background-color: #ddd;\n   -webkit-transition:background-color .15s, box-shadow .04s;\n   transition:background-color .15s, box-shadow .04s;\n"></i>',replace:!0,controller:"WatchLightController",link:function(b,c,d,e){function f(a,b){a=a||"#5AB953",b=b||"#29832B",c.css("background-color",a),c.css("box-shadow","inset 0 0 0 2px "+b),clearTimeout(j),clearTimeout(k),j=setTimeout(g,700),k=setTimeout(h,100)}function g(){c.css("background-color","#ddd")}function h(){c.css("box-shadow","inset 0 0 0 0 #49A34B")}function i(){return e.countWatch(),f(),!1}var j,k;c.on("click",function(){f("#69d","#369"),e.cleanUp(),e.logInformation()}),a.$watch(i)}}}]);